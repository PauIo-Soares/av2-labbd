<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Candidato</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div class="container">
        <div class="row justify-content-center align-items-center min-vh-100 py-5">
            <div class="col-lg-7 col-xl-6">
                
                <!-- Cabe√ßalho centralizado -->
                <div class="text-center mb-5 fade-in">
                    <h1 class="display-5 fw-bold mb-3">üìù Cadastro de Candidato</h1>
                    <p class="lead">Preencha seus dados para receber informa√ß√µes sobre o vestibular</p>
                </div>

                <div class="form-container fade-in">
                <!-- Mensagem de sucesso (se houver) -->
                <div th:if="${sucesso}" class="alert alert-success" role="alert">
                    <strong>Cadastro realizado com sucesso!</strong> Em breve voc√™ receber√° informa√ß√µes sobre o vestibular.
                </div>

                <!-- Mensagem de erro (se houver) -->
                <div th:if="${erro}" class="alert alert-danger" role="alert">
                    <strong>Erro:</strong> <span th:text="${erro}">Mensagem de erro</span>
                </div>

                <!-- Formul√°rio de cadastro -->
                <form th:action="@{/cadastroCandidato}" th:object="${candidato}" method="post">
                    
                    <!-- Nome Completo -->
                    <div class="form-group mb-3">
                        <label for="nome" class="form-label">Nome Completo *</label>
                        <input type="text" 
                               class="form-control" 
                               id="nome" 
                               th:field="*{nome}" 
                               required
                               placeholder="Digite seu nome completo">
                    </div>

                    <!-- E-mail -->
                    <div class="form-group mb-3">
                        <label for="email" class="form-label">E-mail *</label>
                        <input type="email" 
                               class="form-control" 
                               id="email" 
                               th:field="*{email}" 
                               required
                               placeholder="seu.email@exemplo.com">
                    </div>

                    <!-- Telefone Celular -->
                    <div class="form-group mb-3">
                        <label for="telefone" class="form-label">Telefone Celular *</label>
                        <input type="tel" 
                               class="form-control" 
                               id="telefone" 
                               th:field="*{telefone}" 
                               required
                               placeholder="(11) 98765-4321"
                               pattern="\(\d{2}\) \d{4,5}-\d{4}">
                        <small class="form-text text-muted">Formato: (11) 98765-4321</small>
                    </div>

                    <!-- Bairro -->
                    <div class="form-group mb-3">
                        <label for="bairro" class="form-label">Bairro *</label>
                        <input type="text" 
                               class="form-control" 
                               id="bairro" 
                               th:field="*{bairro}" 
                               required
                               placeholder="Digite seu bairro">
                    </div>

                    <!-- Curso de Interesse -->
                    <div class="form-group mb-4">
                        <label for="curso" class="form-label">Curso de Interesse *</label>
                        <select class="form-control" 
                                id="curso" 
                                th:field="*{curso.id}" 
                                required>
                            <option value="">Selecione um curso</option>
                            <option th:each="curso : ${cursos}" 
                                    th:value="${curso.id}" 
                                    th:text="${curso.nome}">
                                Curso
                            </option>
                        </select>
                    </div>

                    <!-- Termo de concord√¢ncia -->
                    <div class="form-check mb-4">
                        <input class="form-check-input" 
                               type="checkbox" 
                               id="concordo" 
                               required>
                        <label class="form-check-label" for="concordo">
                            <strong>Concordo em receber mensagens da Fatec ZL sobre vestibular</strong>
                        </label>
                        <div class="form-text">
                            Ao marcar esta caixa, voc√™ autoriza a Fatec Zona Leste a enviar 
                            informa√ß√µes sobre processos seletivos, vestibulares e eventos 
                            relacionados aos cursos oferecidos pela institui√ß√£o.
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            Cadastrar
                        </button>
                        <a th:href="@{/}" class="btn btn-secondary">
                            Cancelar
                        </a>
                    </div>
                </form>
            </div>
            
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // M√°scara para telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
                value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
                value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
                value = value.replace(/^(\d*)/, '($1');
                e.target.value = value;
            }
        });
    </script>
</body>
</html>

<!-- 
EXPLICA√á√ÉO DETALHADA SOBRE ENVIO DE DADOS PARA DTO:

1. th:object="${candidato}"
   - Vincula o formul√°rio a um objeto chamado "candidato"
   - O Controller deve criar esse objeto vazio antes de exibir a p√°gina

2. th:field="*{nome}"
   - Cria um input com name="nome"
   - Quando o form √© enviado, Spring converte automaticamente para o objeto
   - Se usar DTO: th:field="*{nome}" ‚Üí candidatoDTO.setNome(valor)

3. CONTROLLER PARA EXIBIR O FORMUL√ÅRIO:
   @GetMapping("/cadastroCandidato")
   public String formularioCadastro(Model model) {
       // Cria objeto vazio para o formul√°rio
       model.addAttribute("candidato", new Candidato());
       // ou se usar DTO: model.addAttribute("candidato", new CandidatoDTO());
       
       // Busca lista de cursos para o select
       List<Curso> cursos = cursoService.findAll();
       model.addAttribute("cursos", cursos);
       
       return "cadastroCandidato";
   }

4. CONTROLLER PARA RECEBER OS DADOS:
   @PostMapping("/cadastroCandidato")
   public String salvarCandidato(@ModelAttribute Candidato candidato, 
                                   Model model,
                                   RedirectAttributes redirectAttributes) {
       try {
           // A data/hora √© preenchida automaticamente (use @PrePersist na entidade)
           candidatoService.salvar(candidato);
           
           redirectAttributes.addFlashAttribute("sucesso", true);
           return "redirect:/cadastroCandidato";
       } catch (Exception e) {
           model.addAttribute("erro", e.getMessage());
           model.addAttribute("candidato", candidato);
           model.addAttribute("cursos", cursoService.findAll());
           return "cadastroCandidato";
       }
   }

5. SE USAR DTO (mais recomendado):
   // DTO
   public class CandidatoDTO {
       private String nome;
       private String email;
       private String telefone;
       private String bairro;
       private Long cursoId; // Apenas o ID do curso
       // getters e setters
   }
   
   // Controller
   @PostMapping("/cadastroCandidato")
   public String salvar(@ModelAttribute CandidatoDTO dto, ...) {
       Candidato candidato = new Candidato();
       candidato.setNome(dto.getNome());
       candidato.setEmail(dto.getEmail());
       candidato.setTelefone(dto.getTelefone());
       candidato.setBairro(dto.getBairro());
       
       Curso curso = cursoService.findById(dto.getCursoId());
       candidato.setCurso(curso);
       
       candidato.setDataCadastro(LocalDateTime.now());
       
       candidatoService.salvar(candidato);
       return "redirect:/sucesso";
   }

6. RELACIONAMENTO CURSO (th:field="*{curso.id}"):
   - Spring entende que deve pegar o ID e setar no objeto curso
   - Mas √© melhor usar apenas cursoId no DTO e buscar o curso no service

7. ENTIDADE COM DATA AUTOM√ÅTICA:
   @Entity
   public class Candidato {
       @Id
       @GeneratedValue(strategy = GenerationType.IDENTITY)
       private Long id;
       
       private String nome;
       private String email;
       private String telefone;
       private String bairro;
       
       @ManyToOne
       @JoinColumn(name = "curso_id")
       private Curso curso;
       
       @Column(name = "data_cadastro")
       private LocalDateTime dataCadastro;
       
       @PrePersist
       public void prePersist() {
           dataCadastro = LocalDateTime.now();
       }
   }

FLUXO COMPLETO:
1. Usu√°rio acessa /cadastroCandidato (GET)
2. Controller cria objeto vazio e lista de cursos
3. P√°gina exibe formul√°rio
4. Usu√°rio preenche e envia (POST)
5. Spring converte automaticamente os campos do form para o objeto
6. Controller valida e salva
7. Redireciona com mensagem de sucesso
-->