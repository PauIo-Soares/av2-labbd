<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Administrativo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div class="container">
        <div class="row justify-content-center align-items-center min-vh-100">
            <div class="col-md-6 col-lg-5 col-xl-4">
                
                <!-- Cabe√ßalho centralizado -->
                <div class="text-center mb-5 fade-in">
                    <h1 class="display-5 fw-bold mb-3">üîê √Årea Administrativa</h1>
                    <p class="lead">Acesso restrito a administradores</p>
                </div>

                <div class="form-container fade-in">
                
                <!-- Mensagem de erro -->
                <div th:if="${erro}" class="alert alert-danger" role="alert">
                    <strong>Erro:</strong> <span th:text="${erro}">Login ou senha inv√°lidos</span>
                </div>

                <!-- Formul√°rio de login -->
                <form th:action="@{/loginAdmin}" method="post">
                    
                    <div class="text-center mb-4">
                        <h3>Fazer Login</h3>
                        <p class="text-muted">Digite suas credenciais de acesso</p>
                    </div>

                    <!-- Login -->
                    <div class="form-group mb-3">
                        <label for="login" class="form-label">Login</label>
                        <input type="text" 
                               class="form-control" 
                               id="login" 
                               name="login" 
                               required
                               placeholder="Digite seu login"
                               autofocus>
                    </div>

                    <!-- Senha -->
                    <div class="form-group mb-4">
                        <label for="senha" class="form-label">Senha</label>
                        <input type="password" 
                               class="form-control" 
                               id="senha" 
                               name="senha" 
                               required
                               placeholder="Digite sua senha">
                    </div>

                    <!-- Bot√µes -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            Entrar
                        </button>
                        <a th:href="@{/}" class="btn btn-outline-secondary">
                            Voltar ao In√≠cio
                        </a>
                    </div>
                </form>

                <!-- Informa√ß√£o adicional -->
                <div class="mt-4 p-3 bg-light rounded text-center">
                    <small class="text-muted">
                        <strong>‚ö†Ô∏è Aviso:</strong> Esta √°rea √© exclusiva para administradores do sistema.
                    </small>
                </div>
            </div>
            
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<!-- 
EXPLICA√á√ÉO - LOGIN SEM SPRING SECURITY (USANDO PROCEDURE):

1. FORMUL√ÅRIO SIMPLES:
   - N√£o usa th:object porque n√£o √© uma entidade
   - Usa name="login" e name="senha" para enviar os dados

2. CONTROLLER PARA EXIBIR LOGIN:
   @GetMapping("/loginAdmin")
   public String loginForm() {
       return "loginAdmin";
   }

3. CONTROLLER PARA VALIDAR (usando Stored Procedure):
   @PostMapping("/loginAdmin")
   public String validarLogin(@RequestParam String login,
                               @RequestParam String senha,
                               HttpSession session,
                               RedirectAttributes redirectAttributes) {
       
       // Chama a procedure de valida√ß√£o
       boolean loginValido = adminService.validarLogin(login, senha);
       
       if (loginValido) {
           // Salva na sess√£o que est√° logado
           session.setAttribute("adminLogado", true);
           session.setAttribute("loginAdmin", login);
           return "redirect:/adminMenu";
       } else {
           redirectAttributes.addFlashAttribute("erro", "Login ou senha inv√°lidos");
           return "redirect:/loginAdmin";
       }
   }

4. SERVICE QUE CHAMA A PROCEDURE:
   @Service
   public class AdminService {
       
       @PersistenceContext
       private EntityManager entityManager;
       
       public boolean validarLogin(String login, String senha) {
           try {
               StoredProcedureQuery query = entityManager
                   .createStoredProcedureQuery("sp_validar_admin");
               
               query.registerStoredProcedureParameter("login", String.class, ParameterMode.IN);
               query.registerStoredProcedureParameter("senha", String.class, ParameterMode.IN);
               query.registerStoredProcedureParameter("valido", Integer.class, ParameterMode.OUT);
               
               query.setParameter("login", login);
               query.setParameter("senha", senha);
               
               query.execute();
               
               Integer resultado = (Integer) query.getOutputParameterValue("valido");
               return resultado != null && resultado == 1;
               
           } catch (Exception e) {
               return false;
           }
       }
   }

5. STORED PROCEDURE NO SQL SERVER:
   CREATE PROCEDURE sp_validar_admin
       @login VARCHAR(50),
       @senha VARCHAR(50),
       @valido INT OUTPUT
   AS
   BEGIN
       IF EXISTS (SELECT 1 FROM admin WHERE login = @login AND senha = @senha)
           SET @valido = 1
       ELSE
           SET @valido = 0
   END

6. PROTE√á√ÉO DAS P√ÅGINAS ADMINISTRATIVAS (Interceptor):
   @Component
   public class AdminInterceptor implements HandlerInterceptor {
       
       @Override
       public boolean preHandle(HttpServletRequest request, 
                                HttpServletResponse response, 
                                Object handler) throws Exception {
           
           HttpSession session = request.getSession(false);
           Boolean adminLogado = (Boolean) session.getAttribute("adminLogado");
           
           if (adminLogado == null || !adminLogado) {
               response.sendRedirect("/loginAdmin");
               return false;
           }
           return true;
       }
   }
   
   // Registrar o interceptor
   @Configuration
   public class WebConfig implements WebMvcConfigurer {
       
       @Autowired
       private AdminInterceptor adminInterceptor;
       
       @Override
       public void addInterceptors(InterceptorRegistry registry) {
           registry.addInterceptor(adminInterceptor)
                   .addPathPatterns("/adminMenu", "/cadastroTipo", "/consultaCandidatos");
       }
   }

CREDENCIAIS (conforme especifica√ß√£o):
- Login: admin
- Senha: Jej-W+q%
-->